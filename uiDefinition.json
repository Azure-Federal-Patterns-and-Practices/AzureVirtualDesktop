{
    "$schema": "https://schema.management.azure.com/schemas/2021-09-09/uiFormDefinition.schema.json",
    "view": {
        "kind": "Form",
        "properties": {
            "title": "Azure Virtual Desktop",
            "steps": [
                {
                    "name": "basics",
                    "label": "Basics",
                    "elements": [
                        {
                            "name": "resourceScope",
                            "type": "Microsoft.Common.ResourceScope",
                            "location": {
                                "resourceTypes": [
                                    "Microsoft.Automation/automationAccounts",
                                    "Microsoft.Insights/diagnosticsettings"
                                ]
                            }
                        },
                        {
                            "name": "servicePrincipalApi",
                            "type": "Microsoft.Solutions.GraphApiControl",
                            "request": {
                                "method": "GET",
                                "path": "/v1.0/serviceprincipals?$filter=appId eq '9cdead84-a844-4324-93f2-b2e6bb768d07'"
                            }
                        }
                    ]
                },
                {
                    "name": "hostPool",
                    "label": "Host Pool",
                    "visible": true,
                    "elements": []
                },
                {
                    "name": "virtualMachines",
                    "label": "Virtual Machines",
                    "visible": true,
                    "elements": []
                },
                {
                    "name": "scaling",
                    "label": "Scaling",
                    "visible": true,
                    "elements": [
                        {
                            "name": "beginPeakTime",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Begin Peak Time",
                            "defaultValue": "8:00",
                            "placeholder": "",
                            "toolTip": "Input the time when peak hours begin for your end users.",
                            "constraints": {
                                "required": true,
                                "validations": [
                                    {
                                        "regex": "^[012]?[0-9]:[0-5][0-9]$",
                                        "message": "The value must be in a proper time format with a two digit hour and two digit minutes, e.g. 12am should be input as 00:00."
                                    }
                                ]
                            }
                        },
                        {
                            "name": "endPeakTime",
                            "type": "Microsoft.Common.TextBox",
                            "label": "End Peak Time",
                            "defaultValue": "17:00",
                            "placeholder": "",
                            "toolTip": "Input the time when peak hours end for your end users.",
                            "constraints": {
                                "required": true,
                                "validations": [
                                    {
                                        "regex": "^[012]?[0-9]:[0-5][0-9]$",
                                        "message": "The value must be in a proper time format with a two digit hour and two digit minutes, e.g. 8pm should be input as 20:00."
                                    }
                                ]
                            }
                        },
                        {
                            "name": "forceLogOff",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Force Log Off (Seconds)",
                            "defaultValue": "0",
                            "toolTip": "Use this setting to force logoff users if session time limit settings cannot be used.",
                            "placeholder": "",
                            "multiLine": false,
                            "constraints": {
                                "required": true,
                                "validations": [
                                    {
                                        "regex": "^[0-9]{1,3}$",
                                        "message": "The value must be between 1 and 3 digits."
                                    }
                                ]
                            },
                            "visible": true
                        },
                        {
                            "name": "minimumHosts",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Minimum Number of Session Hosts",
                            "defaultValue": "0",
                            "toolTip": "Use this setting to determine the minimum number of sessions hosts to keep online.",
                            "placeholder": "",
                            "multiLine": false,
                            "constraints": {
                                "required": true,
                                "validations": [
                                    {
                                        "regex": "^[0-9]{1,4}$",
                                        "message": "The value must be between 1 and 4 digits."
                                    }
                                ]
                            },
                            "visible": true
                        },
                        {
                            "name": "cpuThreshold",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Session Threshold Per CPU",
                            "defaultValue": "1",
                            "toolTip": "Use this setting to determine the number of sessions per CPU before turning on another host.",
                            "placeholder": "",
                            "multiLine": false,
                            "constraints": {
                                "required": true,
                                "validations": [
                                    {
                                        "regex": "^[0-9]{0,1}(?:\\.[0-9]{0,2})?$",
                                        "message": "The value must be a number with 1 whole number and, if desired, a single or two digit decimal number."
                                    }
                                ]
                            },
                            "visible": true
                        }
                    ]
                },
                {
                    "name": "monitoring",
                    "label": "Monitoring",
                    "visible": true,
                    "elements": []
                },
                {
                    "name": "tags",
                    "label": "Tags",
                    "visible": true,
                    "elements": []
                }
            ]
        },
        "outputs": {
            "parameters": {
                "ActiveDirectorySolution": "",
                "Availability": "",
                "AvdObjectId": "[first(map(steps('basics').servicePrincipalApi.value, (item) => item.id))]",
                "AzureFilesPrivateDnsZoneResourceId": "",
                "CustomRdpProperty": "",
                "DiskEncryption": "",
                "DiskSku": "",
                "DomainJoinPassword": "",
                "DomainJoinUserPrincipalName": "",
                "DomainName": "",
                "DrainMode": "",
                "Environment": "",
                "FslogixShareSizeInGB": "",
                "FslogixSolution": "",
                "FslogixStorage": "",
                "HostPoolType": "",
                "Identifier": "",
                "ImageOffer": "",
                "ImagePublisher": "",
                "ImageSku": "",
                "ImageVersion": "",
                "KerberosEncryption": "",
                "Location": "",
                "LogAnalyticsWorkspaceRetention": "",
                "LogAnalyticsWorkspaceSku": "",
                "MaxSessionLimit": "",
                "Monitoring": "",
                "OuPath": "",
                "RecoveryServices": "",
                "ScalingBeginPeakTime": "",
                "ScalingEndPeakTime": "",
                "ScalingLimitSecondsToForceLogOffUser": "",
                "ScalingMinimumNumberOfRdsh": "",
                "ScalingSessionThresholdPerCPU": "",
                "ScalingTool": "",
                "ScreenCaptureProtection": "",
                "SecurityPrincipalObjectIds": "",
                "SecurityPrincipalNames": "",
                "SentinelLogAnalyticsWorkspaceName": "",
                "SentinelLogAnalyticsWorkspaceResourceGroupName": "",
                "SentinelLogAnalyticsWorkspaceSubscriptionId": "",
                "SessionHostCount": "",
                "SessionHostIndex": "",
                "StampIndex": "",
                "StorageCount": "",
                "StorageIndex": "",
                "SubnetName": "",
                "Tags": "",
                "ValidationEnvironment": "",
                "VirtualNetworkName": "",
                "VirtualNetworkResourceGroupName": "",
                "VmPassword": "",
                "VmSize": "",
                "VmUsername": ""
            },
            "kind": "Subscription",
            "location": "[steps('basics').resourceScope.location.name]",
            "subscriptionId": "[steps('basics').resourceScope.subscription.id]"
        }
    }
}